<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <title>Панель администратора</title>
  <link href="https://fonts.googleapis.com/css?family=Faster+One" rel="stylesheet">
  <style>
    body {
      font-family: 'Faster One', cursive;
      margin: 20px;
      background-color: #f8f8f8;
    }

    header,
    section {
      margin-bottom: 20px;
    }

    h1,
    h2,
    h3 {
      color: #333;
    }

    article {
      background: white;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    input,
    button {
      margin: 5px 0;
      padding: 8px;
      font-size: 16px;
    }

    button {
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 5px;
    }

    button:hover {
      background-color: #45a049;
    }

    #edit-section {
      display: none;
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <header>
    <h1>Панель администратора</h1>
  </header>

  <!-- Форма добавления товара -->
  <section>
    <h2>Добавить товар</h2>
    <input id="name" placeholder="Название">
    <input id="price" type="number" placeholder="Цена">
    <input id="description" placeholder="Описание">
    <input id="categories" placeholder="Категории через запятую">
    <button onclick="addProduct()">Добавить</button>
  </section>

  <!-- Форма редактирования товара -->
  <section>
    <h2>Редактировать товар</h2>
    <input id="edit-id" type="number" placeholder="ID товара">
    <button onclick="loadProductForEdit()">Загрузить данные</button>

    <div id="edit-section">
      <input id="edit-name" placeholder="Название">
      <input id="edit-price" type="number" placeholder="Цена">
      <input id="edit-description" placeholder="Описание">
      <input id="edit-categories" placeholder="Категории через запятую">
      <button onclick="updateProduct()">Сохранить изменения</button>
    </div>
  </section>

  <!-- Список товаров -->
  <section id="product-list"></section>

  <script>
    // Загрузить список товаров
    function loadProducts() {
      fetch('/products')
        .then(res => res.json())
        .then(products => {
          const section = document.querySelector('#product-list');
          section.innerHTML = '';

          products.forEach(product => {
            const article = document.createElement('article');
            article.innerHTML = `
              <h3>${product.name} (ID: ${product.id})</h3>
              <p>Цена: ${product.price} руб.</p>
              <p>${product.description}</p>
              <p>Категории: ${product.categories.join(', ')}</p>
              <button onclick="deleteProduct(${product.id})">Удалить</button>
            `;
            section.appendChild(article);
          });
        });
    }

    // Добавить новый товар
    function addProduct() {
      const name = document.getElementById('name').value;
      const price = document.getElementById('price').value;
      const description = document.getElementById('description').value;
      const categories = document.getElementById('categories').value.split(',').map(c => c.trim());

      fetch('/products', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, price, description, categories })
      }).then(() => {
        loadProducts();
        document.getElementById('name').value = '';
        document.getElementById('price').value = '';
        document.getElementById('description').value = '';
        document.getElementById('categories').value = '';
      });
    }

    // Удалить товар
    function deleteProduct(id) {
  // Запрос подтверждения у пользователя
  const isConfirmed = confirm('Вы уверены, что хотите удалить этот товар?');
  if (!isConfirmed) {
    return; // Если пользователь нажал "Отмена", прерываем выполнение
  }

  // Если пользователь подтвердил удаление, отправляем запрос на сервер
  fetch(`/products/${id}`, { method: 'DELETE' })
    .then(() => {
      loadProducts(); // Обновляем список товаров после удаления
      alert('Товар успешно удалён'); // Уведомляем пользователя об успешном удалении
    })
    .catch(err => alert('Ошибка при удалении товара: ' + err.message));
}
    // Загрузить данные товара для редактирования
    function loadProductForEdit() {
      const idInput = document.getElementById('edit-id').value;
      const id = Number(idInput);

      if (isNaN(id) || id <= 0) {
        alert('Введите корректный ID товара (должно быть положительное число)');
        return;
      }

      fetch(`/products/${id}`)
        .then(res => {
          if (!res.ok) {
            throw new Error('Товар не найден');
          }
          return res.json();
        })
        .then(product => {
          document.getElementById('edit-name').value = product.name;
          document.getElementById('edit-price').value = product.price;
          document.getElementById('edit-description').value = product.description;
          document.getElementById('edit-categories').value = product.categories.join(', ');
          document.getElementById('edit-section').style.display = 'block';
        })
        .catch(err => alert(err.message));
    }

    // Обновить товар
    function updateProduct() {
      const id = document.getElementById('edit-id').value;
      const name = document.getElementById('edit-name').value;
      const price = document.getElementById('edit-price').value;
      const description = document.getElementById('edit-description').value;
      const categories = document.getElementById('edit-categories').value.split(',').map(c => c.trim());

      fetch(`/products/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, price, description, categories })
      }).then(() => {
        loadProducts();
        document.getElementById('edit-section').style.display = 'none';
        document.getElementById('edit-id').value = '';
        document.getElementById('edit-name').value = '';
        document.getElementById('edit-price').value = '';
        document.getElementById('edit-description').value = '';
        document.getElementById('edit-categories').value = '';
      });
    }

    // Загрузить товары при загрузке страницы
    loadProducts();
  </script>
</body>

</html>